{% extends 'base.html' %}

{% block title %}å¤´ç‰ˆ - æ ¡å›­å¹¿æ’­ç«™ç®¡ç†å¹³å°{% endblock %}

{% block content %}
<!-- Info Bar with Date and Weather -->
<div class="gh-info-bar">
    <div class="gh-info-item">
        <span class="gh-info-icon">ğŸ“…</span>
        <div>
            <div class="gh-info-label">ä»Šæ—¥æ—¥æœŸ</div>
            <div class="gh-info-value">{% now "Yå¹´mæœˆdæ—¥ l" %}</div>
        </div>
    </div>
    <div class="gh-info-item">
        <span class="gh-info-icon">â˜€ï¸</span>
        <div>
            <div class="gh-info-label">å¤©æ°”</div>
            <div class="gh-info-value">æ™´å¤© / 22Â°C</div>
        </div>
    </div>
    <div class="gh-info-item">
        <span class="gh-info-icon">ğŸ™ï¸</span>
        <div>
            <div class="gh-info-label">ä»Šæ—¥å½•éŸ³å®¤é¢„çº¦</div>
            <div class="gh-info-value">{{ today_bookings_count|default:0 }} ä¸ªæ—¶æ®µ</div>
        </div>
    </div>
</div>

<!-- Announcements Section - Main Content Area -->
<div class="gh-announcements-section">
    <h2 class="gh-section-title">ğŸ“‹ æœ€æ–°å…¬å‘Š</h2>
    
    {% if recent_announcements %}
        <div class="gh-announcements-grid">
            {% for announcement in recent_announcements %}
                <div class="gh-announcement-card {% if announcement.type == 'urgent' %}urgent{% endif %}">
                    <div class="gh-announcement-header">
                        <span class="gh-label {% if announcement.type == 'urgent' %}gh-label-urgent{% elif announcement.type == 'activity' %}gh-label-activity{% elif announcement.type == 'schedule_change' %}gh-label-schedule{% else %}gh-label-normal{% endif %}">
                            {% if announcement.type == 'urgent' %}
                                ğŸš¨ ç´§æ€¥
                            {% elif announcement.type == 'activity' %}
                                ğŸ‰ æ´»åŠ¨
                            {% elif announcement.type == 'schedule_change' %}
                                ğŸ“… æ’ç­å˜æ›´
                            {% else %}
                                ğŸ“¢ é€šçŸ¥
                            {% endif %}
                        </span>
                        <span class="gh-announcement-date">{{ announcement.publish_time|date:"m-d H:i" }}</span>
                    </div>
                    <h3 class="gh-announcement-title">
                        <a href="/announcements/{{ announcement.id }}/">{{ announcement.title }}</a>
                    </h3>
                    <p class="gh-announcement-preview">{{ announcement.content|truncatewords:20 }}</p>
                </div>
            {% endfor %}
        </div>
        <div class="gh-card-footer">
            <a href="/announcements/">æŸ¥çœ‹å…¨éƒ¨å…¬å‘Š â†’</a>
        </div>
    {% else %}
        <div class="gh-empty">
            <div class="gh-empty-icon">ğŸ“­</div>
            <p class="gh-empty-text">æš‚æ— å…¬å‘Š</p>
        </div>
    {% endif %}
</div>

<!-- Two Column Layout - Today's Studio & Playlist -->
<div class="gh-two-columns">
    <!-- Left Column: Today's Studio Timeline -->
    <div class="gh-timeline-container">
        <h3 class="gh-timeline-header">ğŸ™ï¸ ä»Šæ—¥å½•éŸ³å®¤å®‰æ’</h3>
        
        {% if today_bookings %}
            <!-- Timeline Scale -->
            <div class="gh-timeline-scale">
                {% for hour in timeline_hours %}
                    <span class="gh-timeline-hour">{{ hour }}:00</span>
                {% endfor %}
            </div>
            
            <!-- Timeline Visualization -->
            <div class="gh-timeline-bookings">
                {% for booking in today_bookings %}
                    <div class="gh-booking-block {{ booking.status }}" 
                         style="left: {{ booking.start_offset }}%; width: {{ booking.width }}%;"
                         title="{{ booking.user.profile.real_name }} - {{ booking.purpose }}">
                        {% if booking.width > 15 %}
                            {{ booking.user.profile.real_name|truncatewords:1 }}
                        {% endif %}
                    </div>
                {% endfor %}
            </div>
            
            <!-- Booking List Details -->
            <div class="gh-booking-list">
                {% for booking in today_bookings %}
                    <div class="gh-booking-item">
                        <span class="gh-booking-time">{{ booking.start_time|time:"H:i" }}-{{ booking.end_time|time:"H:i" }}</span>
                        <div class="gh-booking-info">
                            <div class="gh-booking-user">{{ booking.user.profile.real_name }}</div>
                            <div class="gh-booking-purpose">{{ booking.purpose }}</div>
                        </div>
                        <span class="gh-booking-status {{ booking.status }}">
                            {% if booking.status == 'pending' %}å¾…ç¡®è®¤
                            {% elif booking.status == 'confirmed' %}å·²ç¡®è®¤
                            {% elif booking.status == 'completed' %}å·²å®Œæˆ
                            {% endif %}
                        </span>
                    </div>
                {% endfor %}
            </div>
            
            <div class="gh-card-footer">
                <a href="/studio/">å®Œæ•´å½•éŸ³å®¤é¡µé¢ â†’</a>
            </div>
        {% else %}
            <div class="gh-empty">
                <div class="gh-empty-icon">ğŸ™ï¸</div>
                <p class="gh-empty-text">ä»Šæ—¥æš‚æ— å½•éŸ³å®¤é¢„çº¦</p>
            </div>
            <div class="gh-card-footer">
                <a href="/studio/">å‰å¾€å½•éŸ³å®¤ â†’</a>
            </div>
        {% endif %}
    </div>
    
    <!-- Right Column: Today's Playlist -->
    <div class="gh-playlist-container">
        <h3 class="gh-timeline-header">ğŸµ ä»Šæ—¥å¹¿æ’­æ­Œå•</h3>
        
        {% if today_songs %}
            <ol class="gh-song-list">
                {% for song in today_songs %}
                    <li class="gh-song-item">
                        <span class="gh-song-number">{{ forloop.counter }}.</span>
                        <span class="gh-song-title">{{ song.title }}</span>
                        {% if song.artist %}
                            <span class="gh-song-artist">- {{ song.artist }}</span>
                        {% endif %}
                    </li>
                {% endfor %}
            </ol>
        {% else %}
            <div class="gh-empty">
                <div class="gh-empty-icon">ğŸµ</div>
                <p class="gh-empty-text">ä»Šæ—¥æš‚æ— æ­Œå•å®‰æ’</p>
            </div>
        {% endif %}
        
        <!-- Today's Programs -->
        {% if today_programs %}
            <div class="gh-programs-section">
                <h4 class="gh-programs-title">ğŸ“» ä»Šæ—¥èŠ‚ç›®å®‰æ’</h4>
                {% for program in today_programs %}
                    <div class="gh-program-item">
                        <div class="gh-program-name">{{ program.name }}</div>
                        <div class="gh-program-time">{{ program.time_slot }}</div>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
        
        <div class="gh-card-footer">
            <a href="/studio/">å½•éŸ³å®¤æ—¥å† â†’</a>
        </div>
    </div>
</div>
{% endblock %}
